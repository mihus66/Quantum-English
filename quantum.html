<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum English</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        
        /* –•–µ–¥–µ—Ä */
        header { background: linear-gradient(90deg, #4f46e5, #7c3aed); color: white; padding: 25px 40px; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo i { font-size: 2.5rem; }
        .logo h1 { font-size: 1.8rem; font-weight: bold; }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .auth-container { padding: 40px; max-width: 500px; margin: 50px auto; }
        .auth-box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .auth-title { text-align: center; margin-bottom: 30px; color: #4f46e5; }
        
        /* –§–æ—Ä–º—ã */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        .form-control { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; }
        .form-control:focus { border-color: #4f46e5; outline: none; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        textarea.form-control { min-height: 100px; resize: vertical; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s; }
        .btn-primary { background: #4f46e5; color: white; }
        .btn-primary:hover { background: #4338ca; transform: translateY(-2px); }
        .btn-secondary { background: #10b981; color: white; }
        .btn-secondary:hover { background: #0da271; transform: translateY(-2px); }
        .btn-outline { background: white; border: 2px solid #4f46e5; color: #4f46e5; }
        .btn-outline:hover { background: #4f46e5; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞–Ω–∏–π */
        .assignments-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 25px; }
        .assignment-card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-top: 5px solid #4f46e5; transition: all 0.3s; }
        .assignment-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .assignment-title { color: #4f46e5; font-size: 1.3rem; margin-bottom: 10px; font-weight: 600; }
        .assignment-meta { display: flex; justify-content: space-between; color: #64748b; margin-bottom: 15px; font-size: 0.9rem; }
        .assignment-type { background: #4f46e5; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; }
        .assignment-actions { display: flex; gap: 10px; margin-top: 20px; }
        
        /* –í–æ–ø—Ä–æ—Å—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ */
        .question-item { background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #10b981; }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .options-grid { display: grid; gap: 10px; margin-top: 15px; }
        .option-item { display: flex; align-items: center; gap: 10px; }
        
        /* –¢–µ—Å—Ç –¥–ª—è —É—á–µ–Ω–∏–∫–∞ */
        .test-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .test-question { margin-bottom: 30px; padding-bottom: 25px; border-bottom: 2px solid #f1f5f9; }
        .test-options { display: grid; gap: 12px; margin-top: 15px; }
        .test-option { padding: 15px; background: #f8fafc; border-radius: 8px; border: 2px solid #e2e8f0; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 12px; }
        .test-option:hover { border-color: #c7d2fe; background: #e0e7ff; }
        .test-option.selected { border-color: #10b981; background: #d1fae5; }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .progress-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .progress-table th { background: #f1f5f9; padding: 18px; text-align: left; color: #475569; font-weight: 600; }
        .progress-table td { padding: 18px; border-bottom: 1px solid #e2e8f0; }
        .progress-table tr:hover { background: #f8fafc; }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification { position: fixed; top: 30px; right: 30px; padding: 18px 25px; background: linear-gradient(90deg, #4f46e5, #7c3aed); color: white; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 10000; display: flex; align-items: center; gap: 15px; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .loading i { font-size: 3rem; color: #4f46e5; margin-bottom: 15px; display: block; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <header id="header">
            <div class="logo">
                <i class="fas fa-atom"></i>
                <div>
                    <h1>Quantum English</h1>
                    <p style="opacity: 0.8; font-size: 0.9rem;">–ö–≤–∞–Ω—Ç–æ–≤—ã–π —Å–∫–∞—á–æ–∫ –≤ –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞</p>
                </div>
            </div>
            <div id="userInfo"></div>
        </header>
        
        <div id="mainContent">
            <!-- –§–æ—Ä–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
            <div class="auth-container" id="authSection">
                <div class="auth-box">
                    <h2 class="auth-title" id="authTitle">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                    <form id="authForm">
                        <div class="form-group">
                            <label>Email –∞–¥—Ä–µ—Å</label>
                            <input type="email" id="email" class="form-control" placeholder="–≤–∞—à@email.com" required>
                        </div>
                        <div class="form-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="password" class="form-control" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                        </div>
                        
                        <div id="nameFields" class="hidden">
                            <div class="form-group">
                                <label>–ò–º—è</label>
                                <input type="text" id="firstName" class="form-control" placeholder="–í–∞—à–µ –∏–º—è">
                            </div>
                            <div class="form-group">
                                <label>–§–∞–º–∏–ª–∏—è</label>
                                <input type="text" id="lastName" class="form-control" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>–í—ã:</label>
                            <div style="display: flex; gap: 20px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; flex: 1;">
                                    <input type="radio" name="role" value="student" checked>
                                    <span>–£—á–µ–Ω–∏–∫</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; flex: 1;">
                                    <input type="radio" name="role" value="teacher">
                                    <span>–£—á–∏—Ç–µ–ª—å</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                            <button type="button" id="toggleAuthMode" class="btn btn-outline">
                                <i class="fas fa-user-plus"></i> –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ –¥–æ –≤—Ö–æ–¥–∞) -->
            <div id="appContent" class="hidden" style="padding: 30px;">
                <div style="display: flex; min-height: 600px;">
                    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
                    <div style="width: 250px; background: #f8fafc; padding: 20px; border-radius: 10px; margin-right: 30px;">
                        <div style="margin-bottom: 30px;">
                            <div style="font-weight: bold; color: #4f46e5; margin-bottom: 10px;">–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</div>
                            <div class="menu-item" data-section="dashboard">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                            <div class="menu-item" data-section="assignments">üìù –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</div>
                            <div class="menu-item hidden" id="teacherMenu">
                                <div class="menu-item" data-section="create">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</div>
                                <div class="menu-item" data-section="progress">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–æ–≤</div>
                            </div>
                            <div class="menu-item" data-section="profile">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
                            <div class="menu-item" id="logoutBtn" style="color: #ef4444;">üö™ –í—ã–π—Ç–∏</div>
                        </div>
                    </div>
                    
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                    <div style="flex: 1;">
                        <div id="contentArea">
                            <h2 id="pageTitle" style="color: #4f46e5; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid #4f46e5;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                            <div id="pageContent">
                                <div class="loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === –í–ê–®–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyBCzGe5mTG-IOv42_glPr08Yvyf0JO9aP4",
            authDomain: "site-5bbfb.firebaseapp.com",
            projectId: "site-5bbfb",
            storageBucket: "site-5bbfb.firebasestorage.app",
            messagingSenderId: "832264141262",
            appId: "1:832264141262:web:0008b8345a7027e8f5139f",
            measurementId: "G-RY07J63L4V"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        const app = {
            currentUser: null,
            currentTest: null,
            currentAssignment: null,
            
            init() {
                console.log('Quantum English –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                this.setupEventListeners();
                this.checkAuth();
            },
            
            setupEventListeners() {
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                document.getElementById('toggleAuthMode').addEventListener('click', () => {
                    this.toggleAuthMode();
                });
                
                // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                document.getElementById('authForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAuth();
                });
                
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const section = item.getAttribute('data-section');
                        if (section) this.showSection(section);
                        else if (item.id === 'logoutBtn') this.logout();
                    });
                });
            },
            
            toggleAuthMode() {
                const title = document.getElementById('authTitle');
                const submitBtn = document.querySelector('#authForm button[type="submit"]');
                const toggleBtn = document.getElementById('toggleAuthMode');
                const nameFields = document.getElementById('nameFields');
                
                if (title.textContent === '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É') {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                    title.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Quantum English';
                    submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
                    toggleBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
                    nameFields.classList.remove('hidden');
                } else {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –≤—Ö–æ–¥
                    title.textContent = '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É';
                    submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏';
                    toggleBtn.innerHTML = '<i class="fas fa-user-plus"></i> –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
                    nameFields.classList.add('hidden');
                }
            },
            
            async handleAuth() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const role = document.querySelector('input[name="role"]:checked').value;
                const isLogin = document.getElementById('authTitle').textContent === '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É';
                
                try {
                    if (isLogin) {
                        // –í–•–û–î
                        const userCredential = await auth.signInWithEmailAndPassword(email, password);
                        await this.setupUserData(userCredential.user, firstName, lastName, role);
                        this.showNotification('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                    } else {
                        // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        await this.saveUserToFirestore(userCredential.user, firstName, lastName, role);
                        this.showNotification('üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    this.showNotification('‚ùå ' + this.getErrorMessage(error), true);
                }
            },
            
            async saveUserToFirestore(user, firstName, lastName, role) {
                await db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    email: user.email,
                    firstName: firstName,
                    lastName: lastName,
                    role: role,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                this.currentUser = {
                    uid: user.uid,
                    email: user.email,
                    firstName: firstName,
                    lastName: lastName,
                    role: role
                };
                
                this.showApp();
            },
            
            async setupUserData(user, firstName, lastName, role) {
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (userDoc.exists) {
                    this.currentUser = { uid: user.uid, ...userDoc.data() };
                } else {
                    await this.saveUserToFirestore(user, firstName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', lastName || '', role || 'student');
                }
                
                this.showApp();
            },
            
            showNotification(message, isError = false) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.background = isError ? '#ef4444' : 'linear-gradient(90deg, #4f46e5, #7c3aed)';
                notification.innerHTML = `
                    <i class="fas ${isError ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                    ${message}
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            },
            
            getErrorMessage(error) {
                const messages = {
                    'auth/email-already-in-use': '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω',
                    'auth/invalid-email': '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å',
                    'auth/weak-password': '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤',
                    'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                    'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                    'auth/network-request-failed': '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É'
                };
                return messages[error.code] || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error.message;
            },
            
            checkAuth() {
                auth.onAuthStateChanged((user) => {
                    console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:', user ? '–≤–æ—à–µ–ª' : '–≤—ã—à–µ–ª');
                    if (user) {
                        db.collection('users').doc(user.uid).get().then(doc => {
                            if (doc.exists) {
                                this.currentUser = { uid: user.uid, ...doc.data() };
                                this.showApp();
                            }
                        }).catch(error => {
                            console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                        });
                    } else {
                        this.showAuth();
                    }
                });
            },
            
            showAuth() {
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('appContent').classList.add('hidden');
                document.getElementById('userInfo').innerHTML = '';
            },
            
            showApp() {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('appContent').classList.remove('hidden');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                document.getElementById('userInfo').innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-weight: 500;">
                            ${this.currentUser.firstName} ${this.currentUser.lastName}
                        </div>
                        <div style="background: ${this.currentUser.role === 'teacher' ? '#f59e0b' : '#10b981'}; 
                                    color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.9rem; font-weight: 600;">
                            ${this.currentUser.role === 'teacher' ? 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å' : 'üë®‚Äçüéì –£—á–µ–Ω–∏–∫'}
                        </div>
                    </div>
                `;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–µ–Ω—é –¥–ª—è —É—á–∏—Ç–µ–ª—è
                if (this.currentUser.role === 'teacher') {
                    document.getElementById('teacherMenu').classList.remove('hidden');
                } else {
                    document.getElementById('teacherMenu').classList.add('hidden');
                }
                
                this.showSection('dashboard');
            },
            
            logout() {
                auth.signOut().then(() => {
                    this.showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                });
            },
            
            showSection(section) {
                document.getElementById('pageTitle').textContent = this.getSectionTitle(section);
                document.getElementById('pageContent').innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>';
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é
                document.querySelectorAll('.menu-item[data-section]').forEach(item => {
                    item.style.background = item.getAttribute('data-section') === section ? '#e0e7ff' : 'transparent';
                    item.style.borderRadius = '8px';
                    item.style.padding = '10px';
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å–µ–∫—Ü–∏–∏
                setTimeout(() => {
                    this.loadSectionContent(section);
                }, 100);
            },
            
            getSectionTitle(section) {
                const titles = {
                    'dashboard': '–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
                    'assignments': '–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è',
                    'create': '–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è',
                    'progress': '–ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–æ–≤',
                    'profile': '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'
                };
                return titles[section] || 'Quantum English';
            },
            
            async loadSectionContent(section) {
                const content = document.getElementById('pageContent');
                
                switch(section) {
                    case 'dashboard':
                        await this.loadDashboard();
                        break;
                    case 'assignments':
                        await this.loadAssignments();
                        break;
                    case 'create':
                        await this.loadCreateAssignment();
                        break;
                    case 'progress':
                        await this.loadProgress();
                        break;
                    case 'profile':
                        await this.loadProfile();
                        break;
                }
            },
            
            async loadDashboard() {
                const content = document.getElementById('pageContent');
                
                try {
                    if (this.currentUser.role === 'teacher') {
                        // –î–ª—è —É—á–∏—Ç–µ–ª—è
                        const studentsSnapshot = await db.collection('users')
                            .where('role', '==', 'student')
                            .get();
                        
                        const assignmentsSnapshot = await db.collection('assignments')
                            .where('teacherId', '==', this.currentUser.uid)
                            .get();
                        
                        const resultsSnapshot = await db.collection('results').get();
                        
                        content.innerHTML = `
                            <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                                <h2 style="margin-bottom: 15px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${this.currentUser.firstName}!</h2>
                                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ–±—É—á–µ–Ω–∏—è –≤–∞—à–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤</p>
                            </div>
                            
                            <div class="assignments-grid">
                                <div class="assignment-card">
                                    <div class="assignment-title">üë• –£—á–µ–Ω–∏–∫–∏</div>
                                    <div class="assignment-meta">
                                        <span>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ</span>
                                    </div>
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #4f46e5; text-align: center; margin: 20px 0;">
                                        ${studentsSnapshot.size}
                                    </div>
                                    <div class="assignment-actions">
                                        <button onclick="app.showSection('progress')" class="btn btn-primary">
                                            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="assignment-card">
                                    <div class="assignment-title">üìù –ó–∞–¥–∞–Ω–∏—è</div>
                                    <div class="assignment-meta">
                                        <span>–°–æ–∑–¥–∞–Ω–æ –∑–∞–¥–∞–Ω–∏–π</span>
                                    </div>
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #10b981; text-align: center; margin: 20px 0;">
                                        ${assignmentsSnapshot.size}
                                    </div>
                                    <div class="assignment-actions">
                                        <button onclick="app.showSection('create')" class="btn btn-success">
                                            –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="assignment-card">
                                    <div class="assignment-title">üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                                    <div class="assignment-meta">
                                        <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–±–æ—Ç</span>
                                    </div>
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #f59e0b; text-align: center; margin: 20px 0;">
                                        ${resultsSnapshot.size}
                                    </div>
                                    <div class="assignment-actions">
                                        <button onclick="app.showSection('assignments')" class="btn btn-outline">
                                            –í—Å–µ –∑–∞–¥–∞–Ω–∏—è
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 40px;">
                                <h3 style="color: #4f46e5; margin-bottom: 20px;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                                <div style="display: flex; gap: 15px;">
                                    <button onclick="app.showSection('create')" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                                    </button>
                                    <button onclick="app.showSection('progress')" class="btn btn-secondary">
                                        <i class="fas fa-chart-line"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                                    </button>
                                    <button onclick="app.showSection('assignments')" class="btn btn-outline">
                                        <i class="fas fa-tasks"></i> –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        // –î–ª—è —É—á–µ–Ω–∏–∫–∞
                        const assignmentsSnapshot = await db.collection('assignments').get();
                        const resultsSnapshot = await db.collection('results')
                            .where('studentId', '==', this.currentUser.uid)
                            .get();
                        
                        const completed = resultsSnapshot.size;
                        const total = assignmentsSnapshot.size;
                        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                        
                        content.innerHTML = `
                            <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                                <h2 style="margin-bottom: 15px;">–ü—Ä–∏–≤–µ—Ç, ${this.currentUser.firstName}!</h2>
                                <p>–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∏–∑—É—á–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Å Quantum English!</p>
                            </div>
                            
                            <div class="assignments-grid">
                                <div class="assignment-card">
                                    <div class="assignment-title">üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</div>
                                    <div class="assignment-meta">
                                        <span>–û–∂–∏–¥–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
                                    </div>
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #4f46e5; text-align: center; margin: 20px 0;">
                                        ${total - completed}
                                    </div>
                                    <div class="assignment-actions">
                                        <button onclick="app.showSection('assignments')" class="btn btn-primary">
                                            –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="assignment-card">
                                    <div class="assignment-title">üèÜ –ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                                    <div class="assignment-meta">
                                        <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π</span>
                                    </div>
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #10b981; text-align: center; margin: 20px 0;">
                                        ${completed}
                                    </div>
                                    <div style="margin: 20px 0;">
                                        <div style="height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden;">
                                            <div style="height: 100%; width: ${percentage}%; background: #10b981; border-radius: 6px; transition: width 0.5s;"></div>
                                        </div>
                                        <div style="text-align: center; margin-top: 10px; color: #64748b; font-weight: 600;">${percentage}% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                                    </div>
                                </div>
                                
                                <div class="assignment-card">
                                    <div class="assignment-title">üéØ –°–æ–≤–µ—Ç—ã</div>
                                    <div class="assignment-meta">
                                        <span>–î–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</span>
                                    </div>
                                    <ul style="margin: 20px 0; padding-left: 20px; color: #475569;">
                                        <li style="margin-bottom: 10px;">–†–µ–≥—É–ª—è—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è</li>
                                        <li style="margin-bottom: 10px;">–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª</li>
                                        <li>–ù–µ –±–æ–π—Ç–µ—Å—å –æ—à–∏–±–∞—Ç—å—Å—è</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div style="margin-top: 40px; text-align: center;">
                                <button onclick="app.showSection('assignments')" class="btn btn-primary" style="padding: 15px 40px; font-size: 1.1rem;">
                                    <i class="fas fa-play-circle"></i> –ù–∞—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ
                                </button>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞:', error);
                    content.innerHTML = '<p style="color: #ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.</p>';
                }
            },
            
            async loadAssignments() {
                const content = document.getElementById('pageContent');
                
                try {
                    if (this.currentUser.role === 'teacher') {
                        // –£—á–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∑–∞–¥–∞–Ω–∏—è
                        const assignmentsSnapshot = await db.collection('assignments')
                            .where('teacherId', '==', this.currentUser.uid)
                            .get();
                        
                        if (assignmentsSnapshot.empty) {
                            content.innerHTML = `
                                <div style="text-align: center; padding: 40px;">
                                    <i class="fas fa-tasks" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 20px;"></i>
                                    <h3 style="color: #64748b; margin-bottom: 15px;">–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                                    <p style="color: #94a3b8; margin-bottom: 30px;">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤</p>
                                    <button onclick="app.showSection('create')" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                                    </button>
                                </div>
                            `;
                            return;
                        }
                        
                        let html = `<div class="assignments-grid">`;
                        
                        assignmentsSnapshot.forEach(doc => {
                            const assignment = doc.data();
                            const createdAt = assignment.createdAt ? 
                                assignment.createdAt.toDate().toLocaleDateString('ru-RU') : '–ù–µ–¥–∞–≤–Ω–æ';
                            
                            html += `
                                <div class="assignment-card">
                                    <div class="assignment-title">${assignment.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                                    <div class="assignment-meta">
                                        <span>${createdAt}</span>
                                        <span class="assignment-type">${assignment.type === 'test' ? '–¢–µ—Å—Ç' : '–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ'}</span>
                                    </div>
                                    <p style="color: #64748b; margin-bottom: 15px;">${assignment.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                    <p><strong>–í–æ–ø—Ä–æ—Å–æ–≤:</strong> ${assignment.questions ? assignment.questions.length : 0}</p>
                                    <div class="assignment-actions">
                                        <button onclick="app.previewAssignment('${doc.id}')" class="btn btn-primary">
                                            –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                                        </button>
                                        <button onclick="app.viewAssignmentResults('${doc.id}')" class="btn btn-secondary">
                                            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                        content.innerHTML = html;
                        
                    } else {
                        // –£—á–µ–Ω–∏–∫ –≤–∏–¥–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
                        const assignmentsSnapshot = await db.collection('assignments').get();
                        const resultsSnapshot = await db.collection('results')
                            .where('studentId', '==', this.currentUser.uid)
                            .get();
                        
                        const completedIds = resultsSnapshot.docs.map(doc => doc.data().assignmentId);
                        
                        if (assignmentsSnapshot.empty) {
                            content.innerHTML = `
                                <div style="text-align: center; padding: 40px;">
                                    <i class="fas fa-tasks" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 20px;"></i>
                                    <h3 style="color: #64748b; margin-bottom: 15px;">–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                                    <p style="color: #94a3b8;">–û–∂–∏–¥–∞–π—Ç–µ, –ø–æ–∫–∞ —É—á–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞—Å—Ç –∑–∞–¥–∞–Ω–∏—è</p>
                                </div>
                            `;
                            return;
                        }
                        
                        let html = `<div class="assignments-grid">`;
                        
                        assignmentsSnapshot.forEach(doc => {
                            const assignment = doc.data();
                            const isCompleted = completedIds.includes(doc.id);
                            const teacherName = assignment.teacherName || '–£—á–∏—Ç–µ–ª—å';
                            
                            html += `
                                <div class="assignment-card">
                                    <div class="assignment-title">${assignment.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                                    <div class="assignment-meta">
                                        <span>–û—Ç: ${teacherName}</span>
                                        <span class="assignment-type">${assignment.type === 'test' ? '–¢–µ—Å—Ç' : '–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ'}</span>
                                    </div>
                                    <p style="color: #64748b; margin-bottom: 15px;">${assignment.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                    ${isCompleted ? 
                                        '<p style="color: #10b981; font-weight: 600; margin-bottom: 15px;">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</p>' : 
                                        '<p style="color: #f59e0b; font-weight: 600; margin-bottom: 15px;">‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</p>'
                                    }
                                    <div class="assignment-actions">
                                        ${!isCompleted ? 
                                            `<button onclick="app.startAssignment('${doc.id}')" class="btn btn-primary">
                                                –ù–∞—á–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                                            </button>` :
                                            `<button onclick="app.viewMyResult('${doc.id}')" class="btn btn-secondary">
                                                –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                                            </button>`
                                        }
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                        content.innerHTML = html;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π:', error);
                    content.innerHTML = '<p style="color: #ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.</p>';
                }
            },
            
            async loadCreateAssignment() {
                const content = document.getElementById('pageContent');
                
                if (this.currentUser.role !== 'teacher') {
                    content.innerHTML = '<p style="color: #ef4444;">–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è–º</p>';
                    return;
                }
                
                content.innerHTML = `
                    <div style="max-width: 800px; margin: 0 auto;">
                        <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #4f46e5; margin-bottom: 25px;">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è</h3>
                            
                            <form id="createAssignmentForm">
                                <div class="form-group">
                                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</label>
                                    <input type="text" id="assignmentTitle" class="form-control" 
                                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Present Simple Tense Test" required>
                                </div>
                                
                                <div class="form-group">
                                    <label>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</label>
                                    <textarea id="assignmentDescription" class="form-control" rows="3"
                                              placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label>–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è</label>
                                    <select id="assignmentType" class="form-control">
                                        <option value="test">–¢–µ—Å—Ç (–≤—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞)</option>
                                        <option value="written">–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ</option>
                                    </select>
                                </div>
                                
                                <div id="questionsContainer">
                                    <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                                    <button type="button" id="addQuestionBtn" class="btn btn-secondary">
                                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-rocket"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
                this.addQuestion();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
                document.getElementById('addQuestionBtn').addEventListener('click', () => this.addQuestion());
                document.getElementById('createAssignmentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createAssignment();
                });
            },
            
            addQuestion() {
                const container = document.getElementById('questionsContainer');
                const count = container.children.length + 1;
                
                const questionHtml = `
                    <div class="question-item" data-question-id="${count}">
                        <div class="question-header">
                            <h4 style="color: #4f46e5;">–í–æ–ø—Ä–æ—Å ${count}</h4>
                            <button type="button" class="btn btn-danger" onclick="app.removeQuestion(${count})" ${count === 1 ? 'disabled' : ''}
                                    style="padding: 6px 12px; font-size: 0.9rem;">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>
                            <input type="text" class="form-control question-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å" required>
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞</label>
                            <select class="form-control question-type" onchange="app.toggleQuestionType(${count})">
                                <option value="test">–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</option>
                                <option value="written">–ü–∏—Å—å–º–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç</option>
                            </select>
                        </div>
                        <div id="questionOptions${count}">
                            <div class="options-grid">
                                <div class="option-item">
                                    <input type="radio" name="correct${count}" value="0" checked>
                                    <input type="text" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 1" required>
                                </div>
                                <div class="option-item">
                                    <input type="radio" name="correct${count}" value="1">
                                    <input type="text" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 2" required>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline" onclick="app.addOption(${count})" 
                                    style="margin-top: 10px; padding: 8px 16px;">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç
                            </button>
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', questionHtml);
            },
            
            removeQuestion(questionId) {
                const question = document.querySelector(`[data-question-id="${questionId}"]`);
                if (question) {
                    question.remove();
                }
            },
            
            toggleQuestionType(questionId) {
                const optionsDiv = document.getElementById(`questionOptions${questionId}`);
                const select = document.querySelector(`[data-question-id="${questionId}"] .question-type`);
                
                if (select.value === 'written') {
                    optionsDiv.innerHTML = '<p style="color: #64748b; padding: 10px; background: #f1f5f9; border-radius: 8px;">–£—á–µ–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç.</p>';
                } else {
                    optionsDiv.innerHTML = `
                        <div class="options-grid">
                            <div class="option-item">
                                <input type="radio" name="correct${questionId}" value="0" checked>
                                <input type="text" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 1" required>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="correct${questionId}" value="1">
                                <input type="text" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 2" required>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="app.addOption(${questionId})" 
                                style="margin-top: 10px; padding: 8px 16px;">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç
                        </button>
                    `;
                }
            },
            
            addOption(questionId) {
                const optionsDiv = document.getElementById(`questionOptions${questionId}`);
                const optionCount = optionsDiv.querySelectorAll('.option-item').length;
                
                const optionHtml = `
                    <div class="option-item">
                        <input type="radio" name="correct${questionId}" value="${optionCount}">
                        <input type="text" class="form-control" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ ${optionCount + 1}" required>
                    </div>
                `;
                
                const addButton = optionsDiv.querySelector('button');
                addButton.insertAdjacentHTML('beforebegin', optionHtml);
            },
            
            async createAssignment() {
                try {
                    const title = document.getElementById('assignmentTitle').value;
                    const description = document.getElementById('assignmentDescription').value;
                    const type = document.getElementById('assignmentType').value;
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
                    const questions = [];
                    const questionItems = document.querySelectorAll('.question-item');
                    
                    for (const item of questionItems) {
                        const text = item.querySelector('.question-text').value;
                        const questionType = item.querySelector('.question-type').value;
                        
                        if (questionType === 'test') {
                            const options = [];
                            const optionInputs = item.querySelectorAll('.option-item input[type="text"]');
                            const correctRadio = item.querySelector(`input[name^="correct"]:checked`);
                            
                            optionInputs.forEach((input, index) => {
                                if (input.value.trim()) {
                                    options.push({
                                        text: input.value,
                                        isCorrect: correctRadio && parseInt(correctRadio.value) === index
                                    });
                                }
                            });
                            
                            questions.push({
                                text: text,
                                type: 'test',
                                options: options
                            });
                        } else {
                            questions.push({
                                text: text,
                                type: 'written'
                            });
                        }
                    }
                    
                    if (questions.length === 0) {
                        this.showNotification('‚ùå –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å', true);
                        return;
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore
                    await db.collection('assignments').add({
                        title: title,
                        description: description,
                        type: type,
                        questions: questions,
                        teacherId: this.currentUser.uid,
                        teacherName: `${this.currentUser.firstName} ${this.currentUser.lastName}`,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    this.showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!');
                    this.showSection('assignments');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error);
                    this.showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è: ' + error.message, true);
                }
            },
            
            async loadProgress() {
                const content = document.getElementById('pageContent');
                
                if (this.currentUser.role !== 'teacher') {
                    content.innerHTML = '<p style="color: #ef4444;">–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è–º</p>';
                    return;
                }
                
                try {
                    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤
                    const studentsSnapshot = await db.collection('users')
                        .where('role', '==', 'student')
                        .get();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞–Ω–∏—è —É—á–∏—Ç–µ–ª—è
                    const assignmentsSnapshot = await db.collection('assignments')
                        .where('teacherId', '==', this.currentUser.uid)
                        .get();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    const resultsSnapshot = await db.collection('results').get();
                    
                    let html = `
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #4f46e5; margin-bottom: 15px;">–ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–æ–≤</h3>
                            <p style="color: #64748b;">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤: ${studentsSnapshot.size}</p>
                        </div>
                        
                        <div class="progress-table-container">
                            <table class="progress-table">
                                <thead>
                                    <tr>
                                        <th>–£—á–µ–Ω–∏–∫</th>
                                        <th>Email</th>
                                        <th>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                                        <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                                        <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    if (studentsSnapshot.empty) {
                        html += `
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: #94a3b8;">
                                    <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                                    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>
                                </td>
                            </tr>
                        `;
                    } else {
                        for (const studentDoc of studentsSnapshot.docs) {
                            const student = studentDoc.data();
                            const studentResults = resultsSnapshot.docs
                                .filter(doc => doc.data().studentId === studentDoc.id)
                                .map(doc => doc.data());
                            
                            const completedCount = studentResults.length;
                            const totalScore = studentResults.reduce((sum, result) => sum + (result.score || 0), 0);
                            const averageScore = completedCount > 0 ? (totalScore / completedCount).toFixed(1) : 0;
                            
                            let lastActivity = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏';
                            if (studentResults.length > 0) {
                                const lastResult = studentResults[studentResults.length - 1];
                                if (lastResult.completedAt) {
                                    lastActivity = lastResult.completedAt.toDate().toLocaleDateString('ru-RU');
                                }
                            }
                            
                            html += `
                                <tr>
                                    <td style="font-weight: 600;">${student.firstName} ${student.lastName}</td>
                                    <td>${student.email}</td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span>${completedCount} –∏–∑ ${assignmentsSnapshot.size}</span>
                                            ${assignmentsSnapshot.size > 0 ? `
                                                <div style="flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                                                    <div style="height: 100%; width: ${(completedCount / assignmentsSnapshot.size) * 100}%; 
                                                         background: #10b981; border-radius: 4px;"></div>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </td>
                                    <td>
                                        <span style="font-weight: 600; color: ${averageScore >= 70 ? '#10b981' : averageScore >= 50 ? '#f59e0b' : '#ef4444'}">
                                            ${averageScore}%
                                        </span>
                                    </td>
                                    <td>${lastActivity}</td>
                                    <td>
                                        <button onclick="app.viewStudentProgress('${studentDoc.id}')" class="btn btn-outline" 
                                                style="padding: 6px 12px; font-size: 0.9rem;">
                                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }
                    }
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 30px; display: flex; justify-content: flex-end;">
                            <button onclick="app.exportProgress()" class="btn btn-secondary">
                                <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                    `;
                    
                    content.innerHTML = html;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
                    content.innerHTML = '<p style="color: #ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>';
                }
            },
            
            async loadProfile() {
                const content = document.getElementById('pageContent');
                
                content.innerHTML = `
                    <div style="max-width: 600px; margin: 0 auto;">
                        <div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #4f46e5; margin-bottom: 30px; text-align: center;">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
                            
                            <div class="form-group">
                                <label style="color: #64748b; font-weight: 600; margin-bottom: 8px;">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</label>
                                <div style="padding: 15px; background: #f8fafc; border-radius: 10px; font-size: 1.1rem; color: #1e293b;">
                                    ${this.currentUser.firstName} ${this.currentUser.lastName}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label style="color: #64748b; font-weight: 600; margin-bottom: 8px;">Email –∞–¥—Ä–µ—Å</label>
                                <div style="padding: 15px; background: #f8fafc; border-radius: 10px; color: #475569;">
                                    ${this.currentUser.email}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label style="color: #64748b; font-weight: 600; margin-bottom: 8px;">–†–æ–ª—å</label>
                                <div style="padding: 15px; background: #f8fafc; border-radius: 10px;">
                                    <span style="display: inline-block; background: ${this.currentUser.role === 'teacher' ? '#f59e0b' : '#10b981'}; 
                                          color: white; padding: 5px 15px; border-radius: 20px; font-weight: 600;">
                                        ${this.currentUser.role === 'teacher' ? 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å' : 'üë®‚Äçüéì –£—á–µ–Ω–∏–∫'}
                                    </span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #f1f5f9;">
                                <button onclick="app.logout()" class="btn btn-danger" style="width: 100%; padding: 15px;">
                                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            async startAssignment(assignmentId) {
                try {
                    const doc = await db.collection('assignments').doc(assignmentId).get();
                    if (!doc.exists) {
                        this.showNotification('–ó–∞–¥–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', true);
                        return;
                    }
                    
                    this.currentAssignment = {
                        id: assignmentId,
                        ...doc.data(),
                        userAnswers: []
                    };
                    
                    this.showAssignmentTest();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏—è:', error);
                    this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏—è', true);
                }
            },
            
            showAssignmentTest() {
                const assignment = this.currentAssignment;
                const content = document.getElementById('pageContent');
                
                document.getElementById('pageTitle').textContent = assignment.title;
                
                if (assignment.type === 'test') {
                    this.renderTestQuestions();
                } else {
                    this.renderWrittenAssignment();
                }
            },
            
            renderTestQuestions() {
                const assignment = this.currentAssignment;
                const content = document.getElementById('pageContent');
                const questions = assignment.questions || [];
                
                let html = `<div class="test-container">`;
                
                html += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #4f46e5; margin-bottom: 10px;">${assignment.title}</h3>
                        ${assignment.description ? `<p style="color: #64748b;">${assignment.description}</p>` : ''}
                        <p style="color: #94a3b8; margin-top: 10px;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${questions.length}</p>
                    </div>
                `;
                
                questions.forEach((question, index) => {
                    html += `
                        <div class="test-question" data-question-index="${index}">
                            <h4 style="color: #475569; margin-bottom: 15px;">–í–æ–ø—Ä–æ—Å ${index + 1}: ${question.text}</h4>
                            <div class="test-options">
                    `;
                    
                    if (question.type === 'test' && question.options) {
                        question.options.forEach((option, optIndex) => {
                            html += `
                                <div class="test-option" onclick="app.selectAnswer(${index}, ${optIndex})" 
                                     id="option-${index}-${optIndex}">
                                    <input type="radio" name="question-${index}" id="radio-${index}-${optIndex}">
                                    <label for="radio-${index}-${optIndex}" style="cursor: pointer; flex: 1;">${option.text}</label>
                                </div>
                            `;
                        });
                    } else {
                        html += `
                            <div class="form-group">
                                <textarea class="form-control" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." 
                                          oninput="app.saveWrittenAnswer(${index}, this.value)"></textarea>
                            </div>
                        `;
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        <div style="display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 2px solid #f1f5f9;">
                            <button onclick="app.showSection('assignments')" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞–Ω–∏—è–º
                            </button>
                            <button onclick="app.submitAssignment()" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
                            </button>
                        </div>
                    </div>
                `;
                
                content.innerHTML = html;
            },
            
            renderWrittenAssignment() {
                const assignment = this.currentAssignment;
                const content = document.getElementById('pageContent');
                const questions = assignment.questions || [];
                
                let html = `<div class="test-container">`;
                
                html += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #4f46e5; margin-bottom: 10px;">${assignment.title}</h3>
                        ${assignment.description ? `<p style="color: #64748b;">${assignment.description}</p>` : ''}
                        <p style="color: #94a3b8; margin-top: 10px;">–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ</p>
                    </div>
                `;
                
                questions.forEach((question, index) => {
                    html += `
                        <div class="test-question">
                            <h4 style="color: #475569; margin-bottom: 15px;">${question.text}</h4>
                            <div class="form-group">
                                <textarea class="form-control" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." 
                                          id="written-answer-${index}" 
                                          oninput="app.saveWrittenAnswer(${index}, this.value)"></textarea>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        <div style="display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 2px solid #f1f5f9;">
                            <button onclick="app.showSection('assignments')" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞–Ω–∏—è–º
                            </button>
                            <button onclick="app.submitAssignment()" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
                            </button>
                        </div>
                    </div>
                `;
                
                content.innerHTML = html;
            },
            
            selectAnswer(questionIndex, optionIndex) {
                // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                document.querySelectorAll(`.test-option[id^="option-${questionIndex}-"]`).forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                const selectedOption = document.getElementById(`option-${questionIndex}-${optionIndex}`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                    const radio = selectedOption.querySelector('input[type="radio"]');
                    if (radio) radio.checked = true;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
                    this.currentAssignment.userAnswers[questionIndex] = optionIndex;
                }
            },
            
            saveWrittenAnswer(questionIndex, answer) {
                this.currentAssignment.userAnswers[questionIndex] = answer;
            },
            
            async submitAssignment() {
                try {
                    const assignment = this.currentAssignment;
                    const questions = assignment.questions || [];
                    const userAnswers = assignment.userAnswers || [];
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –µ—Å—Ç—å –æ—Ç–≤–µ—Ç—ã (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
                    if (assignment.type === 'test') {
                        const unanswered = questions.filter((q, index) => 
                            userAnswers[index] === undefined || userAnswers[index] === null
                        ).length;
                        
                        if (unanswered > 0) {
                            this.showNotification(`‚ùå –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã (–æ—Å—Ç–∞–ª–æ—Å—å: ${unanswered})`, true);
                            return;
                        }
                    }
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤
                    let score = 0;
                    if (assignment.type === 'test') {
                        questions.forEach((question, index) => {
                            if (question.type === 'test' && question.options) {
                                const correctIndex = question.options.findIndex(opt => opt.isCorrect);
                                if (userAnswers[index] === correctIndex) {
                                    score++;
                                }
                            }
                        });
                    }
                    
                    const percentage = assignment.type === 'test' && questions.length > 0 ? 
                        Math.round((score / questions.length) * 100) : 0;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    await db.collection('results').add({
                        assignmentId: assignment.id,
                        assignmentTitle: assignment.title,
                        studentId: this.currentUser.uid,
                        studentName: `${this.currentUser.firstName} ${this.currentUser.lastName}`,
                        answers: userAnswers,
                        score: percentage,
                        type: assignment.type,
                        completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        teacherId: assignment.teacherId
                    });
                    
                    if (assignment.type === 'test') {
                        this.showNotification(`‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${percentage}%`);
                    } else {
                        this.showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —É—á–∏—Ç–µ–ª—é!');
                    }
                    
                    this.showSection('assignments');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞–Ω–∏—è:', error);
                    this.showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞–Ω–∏—è', true);
                }
            },
            
            async previewAssignment(assignmentId) {
                try {
                    const doc = await db.collection('assignments').doc(assignmentId).get();
                    if (!doc.exists) {
                        this.showNotification('–ó–∞–¥–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', true);
                        return;
                    }
                    
                    const assignment = doc.data();
                    const content = document.getElementById('pageContent');
                    
                    document.getElementById('pageTitle').textContent = `–ü—Ä–æ—Å–º–æ—Ç—Ä: ${assignment.title}`;
                    
                    let html = `
                        <div style="max-width: 800px; margin: 0 auto;">
                            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                                <h3 style="color: #4f46e5; margin-bottom: 20px;">${assignment.title}</h3>
                                
                                ${assignment.description ? `
                                    <div style="margin-bottom: 25px; padding: 20px; background: #f8fafc; border-radius: 10px;">
                                        <h4 style="color: #475569; margin-bottom: 10px;">–û–ø–∏—Å–∞–Ω–∏–µ</h4>
                                        <p style="color: #64748b;">${assignment.description}</p>
                                    </div>
                                ` : ''}
                                
                                <div style="margin-bottom: 25px;">
                                    <h4 style="color: #475569; margin-bottom: 15px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                        <div style="padding: 15px; background: #f8fafc; border-radius: 10px;">
                                            <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">–¢–∏–ø</div>
                                            <div style="font-weight: 600; color: #4f46e5;">${assignment.type === 'test' ? '–¢–µ—Å—Ç' : '–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ'}</div>
                                        </div>
                                        <div style="padding: 15px; background: #f8fafc; border-radius: 10px;">
                                            <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">–í–æ–ø—Ä–æ—Å–æ–≤</div>
                                            <div style="font-weight: 600; color: #4f46e5;">${assignment.questions ? assignment.questions.length : 0}</div>
                                        </div>
                                        <div style="padding: 15px; background: #f8fafc; border-radius: 10px;">
                                            <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</div>
                                            <div style="font-weight: 600; color: #4f46e5;">
                                                ${assignment.createdAt ? assignment.createdAt.toDate().toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 30px;">
                                    <h4 style="color: #475569; margin-bottom: 20px;">–í–æ–ø—Ä–æ—Å—ã (${assignment.questions ? assignment.questions.length : 0})</h4>
                    `;
                    
                    if (assignment.questions && assignment.questions.length > 0) {
                        assignment.questions.forEach((question, index) => {
                            html += `
                                <div class="question-item" style="margin-bottom: 20px;">
                                    <h5 style="color: #4f46e5; margin-bottom: 10px;">${index + 1}. ${question.text}</h5>
                            `;
                            
                            if (question.type === 'test' && question.options) {
                                html += `<div style="margin-left: 20px;">`;
                                question.options.forEach((option, optIndex) => {
                                    html += `
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; 
                                              padding: 10px; background: ${option.isCorrect ? '#d1fae5' : '#f8fafc'}; 
                                              border-radius: 8px; border-left: 4px solid ${option.isCorrect ? '#10b981' : '#e2e8f0'};">
                                            <div style="width: 24px; height: 24px; border-radius: 50%; background: ${option.isCorrect ? '#10b981' : '#94a3b8'}; 
                                                  color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                                ${String.fromCharCode(65 + optIndex)}
                                            </div>
                                            <span style="color: #475569;">${option.text}</span>
                                            ${option.isCorrect ? '<span style="color: #10b981; margin-left: auto;">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π</span>' : ''}
                                        </div>
                                    `;
                                });
                                html += `</div>`;
                            } else {
                                html += `
                                    <div style="margin-left: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; color: #64748b;">
                                        <i class="fas fa-pen" style="margin-right: 10px;"></i>
                                        –ü–∏—Å—å–º–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
                                    </div>
                                `;
                            }
                            
                            html += `</div>`;
                        });
                    } else {
                        html += `
                            <div style="text-align: center; padding: 40px; color: #94a3b8;">
                                <i class="fas fa-question-circle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                <p>–í–æ–ø—Ä–æ—Å—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                            </div>
                        `;
                    }
                    
                    html += `
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 2px solid #f1f5f9;">
                                    <button onclick="app.showSection('assignments')" class="btn btn-outline">
                                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                                    </button>
                                    <button onclick="app.viewAssignmentResults('${assignmentId}')" class="btn btn-primary">
                                        <i class="fas fa-chart-bar"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    content.innerHTML = html;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞–Ω–∏—è:', error);
                    this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏—è', true);
                }
            },
            
            async viewAssignmentResults(assignmentId) {
                try {
                    const resultsSnapshot = await db.collection('results')
                        .where('assignmentId', '==', assignmentId)
                        .get();
                    
                    const assignmentDoc = await db.collection('assignments').doc(assignmentId).get();
                    const assignment = assignmentDoc.data();
                    
                    const content = document.getElementById('pageContent');
                    
                    document.getElementById('pageTitle').textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: ${assignment.title}`;
                    
                    let html = `
                        <div style="max-width: 1000px; margin: 0 auto;">
                            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                                    <div>
                                        <h3 style="color: #4f46e5; margin-bottom: 10px;">${assignment.title}</h3>
                                        <p style="color: #64748b;">–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${resultsSnapshot.size}</p>
                                    </div>
                                    <button onclick="app.showSection('assignments')" class="btn btn-outline">
                                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                                    </button>
                                </div>
                    `;
                    
                    if (resultsSnapshot.empty) {
                        html += `
                            <div style="text-align: center; padding: 60px; color: #94a3b8;">
                                <i class="fas fa-chart-line" style="font-size: 4rem; margin-bottom: 20px;"></i>
                                <h4 style="margin-bottom: 10px;">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h4>
                                <p>–£—á–µ–Ω–∏–∫–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ</p>
                            </div>
                        `;
                    } else {
                        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        const scores = resultsSnapshot.docs.map(doc => doc.data().score || 0);
                        const averageScore = scores.length > 0 ? 
                            (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1) : 0;
                        const maxScore = Math.max(...scores);
                        const minScore = Math.min(...scores);
                        
                        html += `
                            <div style="margin-bottom: 30px;">
                                <h4 style="color: #475569; margin-bottom: 20px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                    <div style="padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px;">
                                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px;">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
                                        <div style="font-size: 2rem; font-weight: 800;">${averageScore}%</div>
                                    </div>
                                    <div style="padding: 20px; background: #f8fafc; border-radius: 10px;">
                                        <div style="color: #64748b; font-size: 0.9rem; margin-bottom: 5px;">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π</div>
                                        <div style="font-size: 1.5rem; font-weight: 800; color: #10b981;">${maxScore}%</div>
                                    </div>
                                    <div style="padding: 20px; background: #f8fafc; border-radius: 10px;">
                                        <div style="color: #64748b; font-size: 0.9rem; margin-bottom: 5px;">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π</div>
                                        <div style="font-size: 1.5rem; font-weight: 800; color: #f59e0b;">${minScore}%</div>
                                    </div>
                                    <div style="padding: 20px; background: #f8fafc; border-radius: 10px;">
                                        <div style="color: #64748b; font-size: 0.9rem; margin-bottom: 5px;">–í—ã–ø–æ–ª–Ω–∏–ª–∏</div>
                                        <div style="font-size: 1.5rem; font-weight: 800; color: #4f46e5;">${resultsSnapshot.size}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="color: #475569; margin-bottom: 20px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤</h4>
                                <div class="progress-table-container">
                                    <table class="progress-table">
                                        <thead>
                                            <tr>
                                                <th>–£—á–µ–Ω–∏–∫</th>
                                                <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                                                <th>–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                                                <th>–°—Ç–∞—Ç—É—Å</th>
                                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                        `;
                        
                        resultsSnapshot.forEach(doc => {
                            const result = doc.data();
                            const score = result.score || 0;
                            const completedAt = result.completedAt ? 
                                result.completedAt.toDate().toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                            
                            html += `
                                <tr>
                                    <td style="font-weight: 600;">${result.studentName}</td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span style="font-weight: 600; color: ${score >= 70 ? '#10b981' : score >= 50 ? '#f59e0b' : '#ef4444'}">
                                                ${score}%
                                            </span>
                                            <div style="flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                                                <div style="height: 100%; width: ${score}%; 
                                                     background: ${score >= 70 ? '#10b981' : score >= 50 ? '#f59e0b' : '#ef4444'}; 
                                                     border-radius: 4px;"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>${completedAt}</td>
                                    <td>
                                        <span style="display: inline-block; padding: 4px 12px; border-radius: 20px; 
                                              background: ${assignment.type === 'written' && score === 0 ? '#fef3c7' : '#d1fae5'}; 
                                              color: ${assignment.type === 'written' && score === 0 ? '#92400e' : '#065f46'}; 
                                              font-size: 0.85rem; font-weight: 600;">
                                            ${assignment.type === 'written' && score === 0 ? '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ' : '–ó–∞–≤–µ—Ä—à–µ–Ω–æ'}
                                        </span>
                                    </td>
                                    <td>
                                        <button onclick="app.viewStudentResult('${doc.id}')" class="btn btn-outline" 
                                                style="padding: 6px 12px; font-size: 0.9rem;">
                                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        
                        html += `
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        `;
                    }
                    
                    html += `
                                <div style="margin-top: 30px; display: flex; justify-content: space-between;">
                                    <button onclick="app.exportResults('${assignmentId}')" class="btn btn-secondary">
                                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                    </button>
                                    <button onclick="app.showSection('assignments')" class="btn btn-primary">
                                        <i class="fas fa-tasks"></i> –ö —Å–ø–∏—Å–∫—É –∑–∞–¥–∞–Ω–∏–π
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    content.innerHTML = html;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                    this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', true);
                }
            },
            
            async viewMyResult(assignmentId) {
                try {
                    const resultsSnapshot = await db.collection('results')
                        .where('assignmentId', '==', assignmentId)
                        .where('studentId', '==', this.currentUser.uid)
                        .get();
                    
                    if (resultsSnapshot.empty) {
                        this.showNotification('–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', true);
                        return;
                    }
                    
                    const resultDoc = resultsSnapshot.docs[0];
                    const result = resultDoc.data();
                    
                    const assignmentDoc = await db.collection('assignments').doc(assignmentId).get();
                    const assignment = assignmentDoc.data();
                    
                    const content = document.getElementById('pageContent');
                    
                    document.getElementById('pageTitle').textContent = `–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${assignment.title}`;
                    
                    let html = `
                        <div style="max-width: 800px; margin: 0 auto;">
                            <div style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
                                <div style="text-align: center; margin-bottom: 40px;">
                                    <h3 style="color: #4f46e5; margin-bottom: 15px;">${assignment.title}</h3>
                                    <p style="color: #64748b;">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</p>
                                </div>
                                
                                <div style="text-align: center; margin-bottom: 40px;">
                                    <div style="display: inline-block; padding: 30px; background: linear-gradient(135deg, #667eea, #764ba2); 
                                          color: white; border-radius: 50%; width: 150px; height: 150px; display: flex; align-items: center; 
                                          justify-content: center; margin: 0 auto 20px;">
                                        <div>
                                            <div style="font-size: 2.5rem; font-weight: 800;">${result.score || 0}%</div>
                                            <div style="font-size: 0.9rem; opacity: 0.9;">—Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                                        </div>
                                    </div>
                                    <div style="color: #64748b; margin-top: 15px;">
                                        –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${result.completedAt ? result.completedAt.toDate().toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                                    </div>
                                </div>
                    `;
                    
                    if (assignment.type === 'test' && assignment.questions) {
                        html += `
                            <div style="margin-top: 30px;">
                                <h4 style="color: #475569; margin-bottom: 20px; text-align: center;">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤</h4>
                        `;
                        
                        assignment.questions.forEach((question, index) => {
                            const userAnswer = result.answers ? result.answers[index] : null;
                            const isCorrect = question.type === 'test' && question.options ? 
                                question.options[userAnswer]?.isCorrect : false;
                            
                            html += `
                                <div class="question-item" style="margin-bottom: 20px;">
                                    <h5 style="color: #4f46e5; margin-bottom: 10px;">${index + 1}. ${question.text}</h5>
                            `;
                            
                            if (question.type === 'test' && question.options) {
                                question.options.forEach((option, optIndex) => {
                                    const isUserChoice = userAnswer === optIndex;
                                    const isRightAnswer = option.isCorrect;
                                    
                                    html += `
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; padding: 10px; 
                                              background: ${isRightAnswer ? '#d1fae5' : isUserChoice && !isRightAnswer ? '#fee2e2' : '#f8fafc'}; 
                                              border-radius: 8px; border-left: 4px solid ${isRightAnswer ? '#10b981' : isUserChoice && !isRightAnswer ? '#ef4444' : '#e2e8f0'};">
                                            <div style="width: 24px; height: 24px; border-radius: 50%; 
                                                  background: ${isRightAnswer ? '#10b981' : isUserChoice && !isRightAnswer ? '#ef4444' : '#94a3b8'}; 
                                                  color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                                ${String.fromCharCode(65 + optIndex)}
                                            </div>
                                            <span style="color: #475569; flex: 1;">${option.text}</span>
                                            ${isRightAnswer ? '<span style="color: #10b981; font-weight: 600;">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π</span>' : ''}
                                            ${isUserChoice && !isRightAnswer ? '<span style="color: #ef4444; font-weight: 600;">‚úó –í–∞—à –≤—ã–±–æ—Ä</span>' : ''}
                                            ${isUserChoice && isRightAnswer ? '<span style="color: #10b981; font-weight: 600;">‚úì –í–∞—à –≤—ã–±–æ—Ä</span>' : ''}
                                        </div>
                                    `;
                                });
                            } else {
                                html += `
                                    <div style="padding: 15px; background: #f8fafc; border-radius: 8px;">
                                        <div style="color: #64748b; margin-bottom: 10px;">–í–∞—à –æ—Ç–≤–µ—Ç:</div>
                                        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; color: #475569;">
                                            ${userAnswer || '–û—Ç–≤–µ—Ç –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω'}
                                        </div>
                                        ${result.score === 0 ? `
                                            <div style="color: #f59e0b; margin-top: 10px; padding: 10px; background: #fef3c7; border-radius: 8px;">
                                                <i class="fas fa-clock"></i> –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—á–∏—Ç–µ–ª–µ–º
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }
                            
                            html += `</div>`;
                        });
                        
                        html += `</div>`;
                    }
                    
                    html += `
                                <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #f1f5f9; text-align: center;">
                                    <button onclick="app.showSection('assignments')" class="btn btn-primary">
                                        <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–¥–∞–Ω–∏—è–º
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    content.innerHTML = html;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
                    this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', true);
                }
            },
            
            viewStudentProgress(studentId) {
                this.showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', true);
            },
            
            viewStudentResult(resultId) {
                this.showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', true);
            },
            
            exportProgress() {
                this.showNotification('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', true);
            },
            
            exportResults(assignmentId) {
                this.showNotification('–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', true);
            }
        };

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
            window.app = app; // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ
        });
    </script>
</body>
</html>